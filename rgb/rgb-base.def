Bootstrap: docker
From: debian:{{DEBIAN_VERSION}}

%arguments
    DEBIAN_VERSION=trixie
    MPI_PACKAGE=mpich
    GEANT4_VERSION=11.1.3
    ROOT_VERSION=6.30.02

%post
    cd /opt

    apt -y update
    apt -y install apt-utils
    apt -y upgrade
    apt -y install curl

    mkdir geant4-build root-build
    curl https://gitlab.cern.ch/geant4/geant4/-/archive/v{{GEANT4_VERSION}}/geant4-v{{GEANT4_VERSION}}.tar.bz2 -o geant4-build/geant4.tar.bz2 &
    curl https://root.cern/download/root_v{{ROOT_VERSION}}.source.tar.gz -o root-build/root.tar.gz &
    apt -y install build-essential clang vim wget git cmake-qt-gui ninja-build libx11-dev libxpm-dev libxft-dev libxext-dev libssl-dev python3-dev python3 python3-venv python3-pip python3-numpy python3-scipy python3-matplotlib python3-notebook python3-pandas python3-sklearn-pandas python3-full libpcre3-dev libglu1-mesa-dev libglew-dev libftgl-dev default-libmysqlclient-dev libfftw3-dev libcfitsio-dev libavahi-compat-libdnssd-dev libldap2-dev libxml2-dev libkrb5-dev libopenblas-dev libopenblas64-dev libtbb-dev libgsl-dev libgif-dev libafterimage-dev davix-dev libgl2ps-dev liblz4-dev lzma-dev nlohmann-json3-dev libvdt-dev libxrootd-client-dev libxrootd-server-dev libxxhash-dev libxerces-c-dev libexpat1-dev qtbase5-dev libxmu-dev libglib2.0-dev gnulib libgmp-dev libmpc-dev libmpfr-dev libzstd-dev doxygen-gui graphviz {{MPI_PACKAGE}} libeigen3-dev libbackward-cpp-dev libmsgsl-dev libyaml-cpp-dev
    wait

    apt -y autopurge
    apt clean

    cd geant4-build
    tar xf geant4.tar.bz2 &
    cd ../root-build
    tar xf root.tar.gz
    cd ..
    wait

    cd geant4-build
    mv geant4-v{{GEANT4_VERSION}} src
    rm geant4.tar.bz2
    cd ../root-build
    mv root-{{ROOT_VERSION}} src
    rm root.tar.gz
    cd ..

%labels
    Author zhaoshihan
